apiVersion: v1
kind: PersistentVolume
metadata:
  name: nginx-data-pv
  labels:
    type: local
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/mnt/data/ngix"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  # Name of the PersistentVolumeClaim for Nginx data
  name: nginx-data-pvc
spec:
  volumeName: nginx-data-pv
  accessModes:
    # Define access mode as ReadWriteOnce
    - ReadWriteOnce
  resources:
    requests:
      # Request 1GiB of storage
      storage: 1Gi
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: letsencrypt-pv
  labels:
    type: local
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/mnt/data/letsencrypt"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: letsencrypt-pvc # PersistentVolumeClaim for Let's Encrypt
spec:
  volumeName: letsencrypt-pv
  accessModes:
    - ReadWriteOnce # Use mode as ReadWriteOnce
  resources:
    requests:
      storage: 1Gi # Request 1GiB of storage
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-proxy-manager
spec:
  selector:
    app: nginx-proxy-manager
  ports:
    - name: nginxport
      protocol: TCP
      port: 80
      targetPort: 80
    - name: webui
      protocol: TCP
      port: 81
      targetPort: 81
    - name: justtcp
      protocol: TCP
      port: 443
      targetPort: 443
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  # Name your deployment
  name: nginx-proxy-manager
spec:
  # Number of replicas (instances) of the pod
  replicas: 1
  selector:
    matchLabels:
      # Selector to match labels for pod assignment
      app: nginx-proxy-manager
  template:
    metadata:
      labels:
        # Labels the pods created by this deployment
        app: nginx-proxy-manager
    spec:
      containers:
        # Name the Kubernetes container
        - name: nginx-proxy-manager
          # Docker image for Nginx Proxy Manager
          image: jc21/nginx-proxy-manager:latest
          ports:
            - containerPort: 80 # Port 80 Exposed
            - containerPort: 81 # Port 81 Exposed
            - containerPort: 443 # Port 443 Exposed
          volumeMounts:
            - name: data
              mountPath: /data
            - name: letsencrypt
              # Mount path for Let's Encrypt certificates
              mountPath: /etc/letsencrypt
      volumes:
        - name: data
          persistentVolumeClaim:
            # PersistentVolumeClaim for Nginx data
            claimName: nginx-data-pvc
        - name: letsencrypt
          persistentVolumeClaim:
            # PersistentVolumeClaim for Let's Encrypt certificates
            claimName: letsencrypt-pvc
